import{r as c,R as d}from"./index-RYns6xqu.js";import{s as F,V as X,o as K}from"./index.esm-BVcIDkGw.js";/* empty css              *//* empty css              */import"./index-Cm1LdsEh.js";import"./index.esm-CkK1enDk.js";import"./lodash-CcdATr5u.js";import"./index-CHvE9HB5.js";const U={operational_points:[{id:"South_West_station",part:{track:"TB0",position:500,extensions:{sncf:null}},extensions:{sncf:{ci:0,ch:"BV",ch_short_label:"BV",ch_long_label:"0",trigram:"SWS"},identifier:{name:"South_West_station",uic:1}},position:0},{id:"Mid_West_station",part:{track:"TC2",position:450,extensions:{sncf:null}},extensions:{sncf:{ci:0,ch:"BV",ch_short_label:"BV",ch_long_label:"0",trigram:"MWS"},identifier:{name:"Mid_West_station",uic:3}},position:13e6},{id:"Mid_East_station",part:{track:"TD1",position:14e3,extensions:{sncf:null}},extensions:{sncf:{ci:0,ch:"BV",ch_short_label:"BV",ch_long_label:"0",trigram:"MES"},identifier:{name:"Mid_East_station",uic:4}},position:2755e4},{id:"North_East_station",part:{track:"TG5",position:1500,extensions:{sncf:null}},extensions:{sncf:{ci:0,ch:"BV",ch_short_label:"BV",ch_long_label:"0",trigram:"NES"},identifier:{name:"North_East_station",uic:7}},position:4705e4}]},q=[{id:1,name:"Train 1",departure_time:"2024-06-26T13:57:56Z",rolling_stock_length:26070,space_time_curves:[{positions:[0,2387,8642,17449,28163,68719,118795,196855,406366,706610,1102281,1593458,2283409,3769056,6017136,6717050,7000182,9027079,9707244,9996142,12098691,12253708,12305708,12368708,12400708,12424708,12440708,12445708,12448708,12449708,12449708,12452095,12458350,12467157,12490130,12534192,12586918,12734703,12960612,13274175,13680049,14178452,14981343,15960690,18996492,19991990,20987213,22014758,22841279,23850682,26994761,28007168,29005477,30000065,32001426,34522793,44638554,44776040,44832040,44901040,44937040,44976040,44992040,44997040,45000040,45001040],times:[0,42e3,44e3,46e3,48e3,54e3,6e4,68e3,86e3,108e3,134e3,164e3,204e3,286e3,406e3,442e3,456e3,558e3,594e3,61e4,724159,733630,737630,743630,747630,751630,755630,757630,759630,761630,821630,823630,825630,827630,831630,837630,843630,857630,875630,897630,923630,953630,999630,1053630,1215630,1269630,1327630,1389630,1437630,1493630,1661630,1713630,1761630,1807630,1903630,2031630,2561539,2569617,2573617,2579617,2583617,2589617,2593617,2595617,2597617,2599617]}]},{id:2,name:"Train 2",departure_time:"2024-06-26T13:42:56Z",rolling_stock_length:26070,space_time_curves:[{positions:[0,2387,8642,17449,28163,68719,118795,196855,406366,706610,1102281,1593458,2283409,3769056,6017136,6717050,7000182,9027079,9707244,9996142,12098691,12253708,12305708,12368708,12400708,12424708,12440708,12445708,12448708,12449708,12449708,12452095,12458350,12467157,12490130,12534192,12586918,12734703,12960612,13274175,13680049,14178452,14981343,15960690,18996492,19991990,20987213,22014758,22841279,23850682,26994761,28007168,29005477,30000065,32001426,34522793,44638554,44776040,44832040,44901040,44937040,44976040,44992040,44997040,45000040,45001040],times:[0,42e3,44e3,46e3,48e3,54e3,6e4,68e3,86e3,108e3,134e3,164e3,204e3,286e3,406e3,442e3,456e3,558e3,594e3,61e4,724159,733630,737630,743630,747630,751630,755630,757630,759630,761630,821630,823630,825630,827630,831630,837630,843630,857630,875630,897630,923630,953630,999630,1053630,1215630,1269630,1327630,1389630,1437630,1493630,1661630,1713630,1761630,1807630,1903630,2031630,2561539,2569617,2573617,2579617,2583617,2589617,2593617,2595617,2597617,2599617]}]},{id:3,name:"Train 3",departure_time:"2024-06-26T14:12:56Z",rolling_stock_length:26070,space_time_curves:[{positions:[0,2387,8642,17449,28163,68719,118795,196855,406366,706610,1102281,1593458,2283409,3769056,6017136,6717050,7000182,9027079,9707244,9996142,12098691,12253708,12305708,12368708,12400708,12424708,12440708,12445708,12448708,12449708,12449708,12452095,12458350,12467157,12490130,12534192,12586918,12734703,12960612,13274175,13680049,14178452,14981343,15960690,18996492,19991990,20987213,22014758,22841279,23850682,26994761,28007168,29005477,30000065,32001426,34522793,44638554,44776040,44832040,44901040,44937040,44976040,44992040,44997040,45000040,45001040],times:[0,42e3,44e3,46e3,48e3,54e3,6e4,68e3,86e3,108e3,134e3,164e3,204e3,286e3,406e3,442e3,456e3,558e3,594e3,61e4,724159,733630,737630,743630,747630,751630,755630,757630,759630,761630,821630,823630,825630,827630,831630,837630,843630,857630,875630,897630,923630,953630,999630,1053630,1215630,1269630,1327630,1389630,1437630,1493630,1661630,1713630,1761630,1807630,1903630,2031630,2561539,2569617,2573617,2579617,2583617,2589617,2593617,2595617,2597617,2599617]}]}],J=(e,s)=>{const[o,i]=c.useState(!1);return c.useLayoutEffect(()=>{const{current:t}=e,r=()=>{if(t){const l=t.scrollHeight>t.clientHeight;i(l),s&&s(l)}};t&&("ResizeObserver"in window&&new ResizeObserver(r).observe(t),r())},[s,e]),o},Q=(e,s)=>e.positions.map((o,i)=>({time:e.times[i]+new Date(s).getTime(),position:o})),j=(e,s)=>c.useMemo(()=>e.flatMap(o=>o.space_time_curves.map((i,t)=>({id:`${o.id}-${t}`,label:o.name,color:s&&s===o.id?"#201EDE":"#000000",points:Q(i,o.departure_time)}))),[e,s]),O=32,ee=521,te=ee+40,se=1,oe=10,ie=1,ne=10.5,R=.5,ce=40,$=60*60*12,b=e=>e-ce-O,ae=e=>e/1e3,S=e=>e.at(-1).position-e.at(0).position,re=(e,{height:s,isProportional:o,yZoom:i})=>{if(!o||e.length===0)return e.map(u=>({...u,display:!0}));const t=[{...e[0],display:!0}],r=S(e),l=b(s);let m=t[0];for(let u=1;u<e.length;u++){const a=e[u],T=(a.position-m.position)/r*l*i>=O;T&&(t.push({...a,display:T}),m=a)}const f=t[t.length-1];if(!f.display){const u=t.findLast(a=>a.display);u&&(u.display=!1,f.display=!0)}return t},le=(e,{height:s,isProportional:o,yZoom:i})=>{if(e.length<2)return[];const t=S(e),r=b(s);return e.map((l,m)=>{const f=e.at(m+1);return f?o?{...l,styles:{height:`${(f.position-l.position)/t*r*i}px`}}:{...l,styles:{height:`${O*i}px`}}:{...l,styles:{height:`${O}px`}}})},me=e=>{const{minTime:s,maxTime:o}=e.reduce((t,r)=>{if(r.space_time_curves.length===0)return t;const l=r.space_time_curves.at(-1);if(!l||l.times.length<2)return t;const m=Number(new Date(r.departure_time)),f=Number(new Date(r.departure_time))+l.times.at(-1);return{minTime:t.minTime===-1||t.minTime>m?m:t.minTime,maxTime:t.maxTime===-1||t.maxTime<f?f:t.maxTime}},{minTime:-1,maxTime:-1}),i=ae(o-s);return i>$?$:i},fe=e=>e.map(s=>({id:s.id,label:s.id,position:s.position,importanceLevel:1})),ue=(e,{height:s,isProportional:o,yZoom:i})=>{if(e.length<2)return[];if(!o)return e.slice(0,-1).map((u,a)=>{const h=e[a+1];return{from:u.position,to:h.position,size:O*i}});const t=e.at(0).position,r=e.at(-1).position,l=S(e),m=b(s),f=o?{coefficient:l/m/i}:{size:O*(e.length-1)*i};return[{from:t,to:r,...f}]},pe=(e,s,{delta:o,position:{x:i}})=>{const t=Math.min(Math.max(e*(1+o/10),se),oe);return{xZoom:t,xOffset:i-(i-s)/e*t}};function _e(e,s){return{x:s.x-e.x,y:s.y-e.y}}const de=(e,s,o,i,t=561)=>{const[r,l]=c.useState(!1),[m,f]=c.useState({xZoom:1,yZoom:1,xOffset:0,yOffset:0,panning:null,scrollPosition:0,isProportional:!0,operationalPointsChart:[],panY:!1,scales:[]}),{xZoom:u,yZoom:a,xOffset:h,yOffset:T,panY:I,panning:M,scrollPosition:v,isProportional:_}=m,k=j(s,i),G=c.useCallback(n=>{f(p=>({...p,panY:n}))},[]);J(o,G);const D=c.useMemo(()=>me(s),[s]),y=c.useMemo(()=>re(e,{height:t,isProportional:_,yZoom:a}),[e,t,_,a]),H=c.useMemo(()=>le(y,{height:t,isProportional:_,yZoom:a}),[y,t,a,_]),E=c.useMemo(()=>fe(y),[y]),A=c.useCallback(()=>{a<ne&&f(n=>({...n,yZoom:a+R}))},[a]),W=c.useCallback(()=>{a>ie&&f(n=>({...n,yZoom:a-R}))},[a]),L=c.useCallback(()=>{f(n=>({...n,yZoom:1}))},[]),N=c.useCallback(()=>{if(!r&&o.current){const{scrollTop:n}=o.current;(n||n===0)&&f(p=>({...p,scrollPosition:n,yOffset:n}))}},[r,o]),w=c.useCallback(n=>{n.key==="Shift"&&l(!0)},[]),P=c.useCallback(n=>{n.key==="Shift"&&l(!1)},[]);c.useEffect(()=>(window.addEventListener("keydown",w),window.addEventListener("keyup",P),()=>{window.removeEventListener("keydown",w),window.removeEventListener("keyup",P)}),[w,P]);const Z=c.useCallback(()=>{f(n=>({...n,isProportional:!n.isProportional}))},[]),B=c.useMemo(()=>ue(E,{height:t,isProportional:_,yZoom:a}),[E,t,_,a]),V=c.useMemo(()=>({operationalPoints:H,zoomYIn:A,zoomYOut:W,resetZoom:L,toggleMode:Z,yZoom:a,isProportional:_}),[H,A,W,L,Z,a,_]),Y=c.useMemo(()=>({operationalPoints:E,spaceScales:B,timeScale:D/u,paths:k,xOffset:h,yOffset:-v+14,onZoom:n=>{r&&f(p=>({...p,...pe(p.xZoom,p.xOffset,n)}))},onPan:n=>{const p=_e(n.initialPosition,n.position),g={...m};if(!n.isPanning)g.panning=null;else if(!M)g.panning={initialOffset:{x:h,y:T}};else{const{initialOffset:z}=M;if(g.xOffset=z.x+p.x,I){const x=z.y-p.y;o.current&&x>=0&&x+te<=o.current.scrollHeight&&(g.yOffset=x,g.scrollPosition=x,o.current.scrollTop=x)}}f(g)}}),[E,B,D,u,k,h,I,v,r,m,M,T,o]);return c.useMemo(()=>({manchetteProps:V,spaceTimeChartProps:Y,handleScroll:N}),[V,Y,N])},C=561,he=({operationalPoints:e,projectPathTrainResult:s,selectedTrain:o})=>{const i=c.useRef(null),{manchetteProps:t,spaceTimeChartProps:r,handleScroll:l}=de(e,s,i,o);return d.createElement("div",{className:"manchette-space-time-chart-wrapper"},d.createElement("div",{className:"header bg-ambientB-5 w-full border-b border-grey-30",style:{height:"40px"}}),d.createElement("div",{ref:i,className:"manchette flex",style:{height:`${C}px`},onScroll:l},d.createElement(F,{...t}),d.createElement("div",{className:"space-time-chart-container w-full sticky",style:{bottom:0,left:0,top:2,height:`${C-6}px`}},d.createElement(X,{className:"inset-0 absolute h-full",spaceOrigin:0,timeOrigin:Math.min(...s.map(m=>+new Date(m.departure_time))),...r},r.paths.map(m=>d.createElement(K,{key:m.id,path:m,color:m.color}))))))},Pe={title:"Manchette with SpaceTimeChart/rendering",component:he},be={args:{operationalPoints:U.operational_points,projectPathTrainResult:q,selectedTrain:1}},Se=["Default"];export{be as Default,Se as __namedExportsOrder,Pe as default};
