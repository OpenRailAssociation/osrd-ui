/* empty css              */import{R as S,r}from"./index-RYns6xqu.js";import{c as de}from"./index-Cm1LdsEh.js";import{d as We,t as ze}from"./index.esm-CkK1enDk.js";import{l as X}from"./lodash-CcdATr5u.js";import{c as Fe}from"./index-CHvE9HB5.js";const He=({operationalPoint:{extensions:e,id:o,position:i,display:l,onClick:x},isActive:b})=>{var P,v;const y=r.useRef(null);return l?S.createElement("div",{className:de("flex op items-baseline",{"menu-active":b}),id:o,ref:y,onClick:()=>{x&&x(o,y.current)}},S.createElement("div",{className:"op-position justify-self-start text-end"},(t=>Math.round(t/1e6*10)/10)(i)),S.createElement("div",{className:"op-name mx-2 justify-self-start"},(P=e==null?void 0:e.identifier)===null||P===void 0?void 0:P.name),S.createElement("div",{className:"op-separator"}),S.createElement("div",{className:"op-ch font-mono justify-self-end"},(v=e==null?void 0:e.sncf)===null||v===void 0?void 0:v.ch),S.createElement("div",{className:"op-separator"}),S.createElement("div",{className:"op-type"}),S.createElement("div",{className:"op-separator"})):null},Be=({operationalPoints:e,activeOperationalPointId:o})=>S.createElement("div",{className:"operational-point-list "},e.map(i=>S.createElement("div",{key:i.id,className:"operational-point-wrapper flex flex-col justify-start",style:i.styles},S.createElement(He,{operationalPoint:i,isActive:o===i.id})))),lt=({zoomYIn:e,zoomYOut:o,resetZoom:i,yZoom:l=1,operationalPoints:x,activeOperationalPointId:b,isProportional:P=!0,toggleMode:v,children:y})=>S.createElement("div",{className:"manchette-container"},S.createElement("div",{className:"bg-ambientB-10 border-r border-grey-30",style:{minHeight:"521px"}},S.createElement(Be,{operationalPoints:x,activeOperationalPointId:b}),y),S.createElement("div",{className:"manchette-actions"},S.createElement("div",{className:"zoom-buttons"},S.createElement("button",{className:"zoom-out",onClick:o,disabled:l<=1},S.createElement(We,null)),S.createElement("button",{className:"zoom-in",onClick:e,disabled:l>=10.5},S.createElement(ze,null)),S.createElement("button",{className:"zoom-reset",onClick:i},"Fit")),S.createElement("div",{className:"flex items-center ml-auto text-sans font-semibold"},S.createElement("button",{className:"toggle-mode",onClick:v},S.createElement("div",{className:"flex flex-col items-end pr-2"},S.createElement("span",{className:de({"text-grey-30":!P})},"Km"),S.createElement("span",{className:de({"text-grey-30":P})},"LinÃ©aire"))))));function Ze(e,o,i,l){return new(i||(i=Promise))(function(x,b){function P(t){try{y(l.next(t))}catch(a){b(a)}}function v(t){try{y(l.throw(t))}catch(a){b(a)}}function y(t){var a;t.done?x(t.value):(a=t.value,a instanceof i?a:new i(function(p){p(a)})).then(P,v)}y((l=l.apply(e,o||[])).next())})}function Ne(e){const[o,i]=r.useState({width:(e==null?void 0:e.offsetWidth)||1,height:(e==null?void 0:e.offsetHeight)||1});return r.useEffect(()=>{const l=()=>{const x=(e==null?void 0:e.offsetWidth)||1,b=(e==null?void 0:e.offsetHeight)||1;x===o.width&&b===o.height||i({width:x,height:b})};if(e){const x=new ResizeObserver(l);return x.observe(e),()=>{x.disconnect()}}l()},[e,o.height,o.width]),o}const qe=r.createContext(void 0),Ee=r.createContext(void 0),Ye=r.createContext(void 0),ke="stop",fe=["paths"],me=["background","graduations","paths","captions","overlay"],Le={},ye={};function Ce(e){if(ye[e])return ye[e];const o=`#${e.toString(16).padStart(6,"0")}`.toLowerCase();return Le[o]=e,ye[e]=o,o}function xe(e){return e.toString(16).padStart(2,"0").toLowerCase()}function Oe(e){return Fe(e).rgba()}const Ae="picking",Te="rendering";function Ke(e,o,i){const l=r.useRef({}),x=r.useRef({}),b=r.useRef(fe.reduce((c,u)=>Object.assign(Object.assign({},c),{[u]:new Set}),{})),P=r.useRef(me.reduce((c,u)=>Object.assign(Object.assign({},c),{[u]:new Set}),{})),v=r.useRef(o),y=r.useRef(null),t=Ne(e),[a,p]=r.useState(null),s=r.useCallback((c,u)=>{c.resetPickingElements(),fe.forEach(n=>{if(u&&!u.has(n))return;const f=x.current[`${Ae}-${n}`],C=b.current[n];if(f){f.clearRect(0,0,f.canvas.width,f.canvas.height);const w=f.getImageData(0,0,f.canvas.width,f.canvas.height);C.forEach(A=>A(w,c)),f.putImageData(w,0,0)}})},[]),m=r.useCallback((c,u)=>{me.forEach(n=>{if(u&&!u.has(n))return;const f=x.current[`${Te}-${n}`],C=P.current[n];f&&(f.clearRect(0,0,f.canvas.width,f.canvas.height),C.forEach(w=>w(f,c)))})},[]),d=r.useCallback(()=>{m(v.current),s(v.current),y.current&&(window.cancelAnimationFrame(y.current.frameId),y.current=null)},[]),g=r.useCallback(()=>{y.current||(y.current={frameId:window.requestAnimationFrame(d)})},[]),h=r.useCallback(({type:c,layer:u,fn:n})=>{if(c==="picking"){const f=b.current[u];if(f.has(n))throw new Error("This picking function has already been registered.");f.add(n)}else if(c==="rendering"){const f=P.current[u];if(f.has(n))throw new Error("This drawing function has already been registered.");f.add(n)}g()},[]),k=r.useCallback(({type:c,layer:u,fn:n})=>{if(c==="picking"){const f=b.current[u];if(!f.has(n))throw new Error("This picking function has not been registered.");f.delete(n)}else if(c==="rendering"){const f=P.current[u];if(!f.has(n))throw new Error("This drawing function has not been registered.");f.delete(n)}g()},[]),O=r.useCallback(()=>function(c,u){return Ze(this,arguments,void 0,function*(n,f,C="#fff"){if(!f.length)throw Error("There must be at least one layer to capture.");const w=n[f[0]],A=w.width,Z=w.height,J=document.createElement("CANVAS");J.setAttribute("width",A+""),J.setAttribute("height",Z+"");const q=J.getContext("2d");return q.fillStyle=C,q.fillRect(0,0,A,Z),f.forEach(Y=>{q.drawImage(n[Y],0,0,A,Z,0,0,A,Z)}),new Promise((Y,B)=>{J.toBlob(ne=>{ne?Y(ne):B()},"image/png")})})}(l.current,me.map(c=>`${Te}-${c}`),v.current.theme.background),[]);return r.useEffect(()=>{if(!e)return;const c=l.current,u=x.current;[...me.map(n=>({layer:n,type:"rendering"})),...fe.map(n=>({layer:n,type:"picking"}))].forEach(({layer:n,type:f})=>{const C=`${f}-${n}`;if(!c[C]){const w=document.createElement("CANVAS"),A=w.getContext("2d");w.style.position="absolute",w.style.inset="0",e.appendChild(w),c[C]=w,u[C]=A,f==="picking"&&(w.style.display="none")}})},[e]),r.useEffect(()=>{v.current=o,d()},[o.fingerprint]),r.useEffect(()=>{for(const c in l.current){const u=l.current[c];u&&(u.style.width=t.width+"px",u.style.height=t.height+"px",u.setAttribute("width",t.width+"px"),u.setAttribute("height",t.height+"px"))}d()},[t]),r.useEffect(()=>{let c=null;fe.some(u=>{const n=x.current[`${Ae}-${u}`];if(n&&i){const[f,C,w,A]=n.getImageData(i.x,i.y,1,1).data;if(A===255){const Z=function(Y,B,ne){return`#${xe(Y)}${xe(B)}${xe(ne)}`}(f,C,w),J=function(Y){return Le[Y.toLowerCase()]}(Z),q=v.current.pickingElements[J];return c={layer:u,element:q},!0}}return!1}),X.isEqual(c,a)||p(c)},[i,a]),{canvasContext:r.useMemo(()=>({register:h,unregister:k,captureCanvases:O}),[h,k,O]),hoveredItem:a}}function ge(e,o){const{register:i,unregister:l}=r.useContext(Ee);r.useEffect(()=>(i({type:"rendering",layer:e,fn:o}),()=>{l({type:"rendering",layer:e,fn:o})}),[e,o,i,l])}const Ue=()=>(ge("graduations",r.useCallback((e,{timePixelOffset:o,getSpacePixel:i,operationalPoints:l,swapAxis:x,width:b,height:P,theme:{spaceGraduationsStyles:v}})=>{const y=x?P:b;l.forEach(t=>{const a=v[t.importanceLevel||0];if(!a)return;e.strokeStyle=a.color,e.lineWidth=a.width,e.globalAlpha=a.opacity||1,a.dashArray&&(e.setLineDash(a.dashArray||[]),e.lineDashOffset=-o);const p=i(t.position);e.beginPath(),x?(e.moveTo(p,0),e.lineTo(p,y)):(e.moveTo(0,p),e.lineTo(y,p)),e.stroke()}),e.setLineDash([]),e.lineDashOffset=0,e.globalAlpha=1},[])),null),oe="#2170B9",ve="#B6B2AF",se="IBM Plex Sans",Re=6e4,le=36e5,Ve={background:"white",breakpoints:[.2,.4,.8,2.4,12,32,72,1/0],timeRanges:[1e4,3e4,6e4,3e5,9e5,18e5,1*le,3*le,6*le,12*le,24*le],pathsStyles:{fontSize:10,fontFamily:se},spaceGraduationsStyles:{1:{width:.5,color:oe,opacity:.75},2:{width:.5,color:oe,opacity:.25},3:{width:.5,color:"#EDEDED"}},timeCaptionsPriorities:[[0,0,0,0,0,0,0,0,1,1,1],[0,0,0,0,0,0,0,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1],[0,0,0,0,0,3,1,1,1,1,1],[0,0,0,3,2,1,1,1,1,1,1],[0,0,0,3,2,1,1,1,1,1,1],[0,0,3,2,1,1,1,1,1,1,1],[0,0,3,2,1,1,1,1,1,1,1]],timeCaptionsStyles:{1:{color:"#797671",font:`12px ${se}`,topOffset:11},2:{color:ve,font:`12px ${se}`,topOffset:9},3:{color:ve,font:`10px ${se}`,topOffset:6},4:{color:ve,font:`8px ${se}`,topOffset:8}},timeGraduationsPriorities:[[0,0,0,0,0,0,0,4,3,2,1],[0,0,0,0,0,0,4,3,3,2,1],[0,0,0,0,0,6,4,3,3,2,1],[0,0,0,0,6,5,4,3,3,2,1],[0,0,0,6,5,4,3,2,2,2,1],[0,0,6,5,4,4,3,2,2,2,1],[0,6,5,4,4,4,3,2,2,2,1],[6,0,5,4,4,4,3,2,2,2,1]],timeGraduationsStyles:{1:{width:.5,color:"#000000"},2:{width:.5,color:oe,opacity:.77},3:{width:.5,color:oe,opacity:.5},4:{width:.5,color:oe,opacity:.5,dashArray:[6,6]},5:{width:.5,color:oe,opacity:.5,dashArray:[6,18]},6:{width:1,color:oe,opacity:.5,dashArray:[1,12]}}},he=e=>`:${new Date(e).getMinutes().toString().padStart(2,"0")}`,ce=(e,o)=>{const i=new Date(e);return o>1?`${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}`:i.getHours().toString().padStart(2,"0")},te=33,Je=[()=>"",()=>"",he,he,he,he,ce,ce,ce,ce,ce],Xe=()=>(ge("captions",r.useCallback((e,{timeScale:o,timeOrigin:i,timePixelOffset:l,getTimePixel:x,swapAxis:b,width:P,height:v,theme:{background:y,breakpoints:t,timeRanges:a,timeCaptionsPriorities:p,timeCaptionsStyles:s,timeGraduationsStyles:m}})=>{const d=b?v:P,g=b?P:v,h=i-o*l,k=h+o*P,O=1/o*Re;let c=[];t.some((n,f)=>O<n&&(c=p[f],!0));const u={};a.map((n,f)=>{const C=c[f];if(!C)return;let w=Math.floor(h/n)*n;for(;w<=k;)C&&(u[w]={level:C,rangeIndex:f}),w+=n}),e.fillStyle=y,b?e.fillRect(0,0,te,d):e.fillRect(0,g-te,d,te),e.strokeStyle=m[1].color,e.lineWidth=m[1].width,e.beginPath(),b?(e.moveTo(te,0),e.lineTo(te,d)):(e.moveTo(0,g-te),e.lineTo(d,g-te)),e.stroke();for(const n in u){const{level:f,rangeIndex:C}=u[n],w=s[f],A=(0,Je[C])(+n,O);e.textAlign="center",e.textBaseline="top",e.fillStyle=w.color,e.font=`${w.fontWeight||"normal"} ${w.font}`,b?(e.save(),e.translate(te-(w.topOffset||0),x(+n)),e.rotate(Math.PI/2),e.fillText(A,0,0),e.restore()):e.fillText(A,x(+n),g-te+(w.topOffset||0))}},[])),null),Qe=()=>(ge("graduations",r.useCallback((e,{timeScale:o,timeOrigin:i,timePixelOffset:l,spacePixelOffset:x,getTimePixel:b,swapAxis:P,width:v,height:y,theme:{breakpoints:t,timeRanges:a,timeGraduationsStyles:p,timeGraduationsPriorities:s}})=>{const m=P?v:y,d=i-o*l,g=d+o*(P?y:v),h=1/o*Re;let k=[];t.some((c,u)=>h<c&&(k=s[u],!0));const O={};a.map((c,u)=>{const n=k[u];if(!n)return;let f=Math.floor(d/c)*c;for(;f<=g;)O[f]=n,f+=c});for(const c in O){const u=p[O[c]];e.strokeStyle=u.color,e.lineWidth=u.width,e.globalAlpha=u.opacity||1,e.setLineDash(u.dashArray||[]),u.dashArray&&(e.lineDashOffset=-x);const n=b(+c);e.beginPath(),P?(e.moveTo(0,n),e.lineTo(m,n)):(e.moveTo(n,0),e.lineTo(n,m)),e.stroke()}e.setLineDash([]),e.lineDashOffset=0,e.globalAlpha=1},[])),null);function Me(e,o){const i=o.getBoundingClientRect();return{x:e.clientX-i.left,y:e.clientY-i.top}}function _e(e){if(e.deltaY!==void 0)return-3*e.deltaY/360;if(e.detail!==void 0)return e.detail/-9;throw new Error("Could not extract delta from event.")}function Ie(e,o){e=X.clamp(e,o.from,o.to);let i=o;for(;"limit"in i;)i=e<=i.limit?i.left:i.right;return i}function et(e,o,i){return l=>{const{from:x,pixelFrom:b,coefficient:P}=function(v,y){v=X.clamp(v,y.pixelFrom,y.pixelTo);let t=y;for(;"pixelLimit"in t;)t=v<=t.pixelLimit?t.left:t.right;return t}(l-o,i);return e+x+(l-o-b)*P}}function je(e,o,i){if(o<e)return je(o,e,i).reverse();e=Math.max(e,i.from),o=Math.min(o,i.to);let l=Ie(e,i),x=e;const b=[];for(;l.to<o;)l.to!==x&&b.push(l.to),x=l.to,l=l.next;return b}const ct=e=>{const{operationalPoints:o,spaceOrigin:i,spaceScales:l,timeOrigin:x,timeScale:b,xOffset:P=0,yOffset:v=0,swapAxis:y,onHoveredChildUpdate:t,children:a,enableSnapping:p,hideGrid:s,hidePathsLabels:m,theme:d,onPan:g,onZoom:h,onClick:k,onMouseMove:O}=e,c=function(E,M){var R={};for(var T in E)Object.prototype.hasOwnProperty.call(E,T)&&M.indexOf(T)<0&&(R[T]=E[T]);if(E!=null&&typeof Object.getOwnPropertySymbols=="function"){var I=0;for(T=Object.getOwnPropertySymbols(E);I<T.length;I++)M.indexOf(T[I])<0&&Object.prototype.propertyIsEnumerable.call(E,T[I])&&(R[T[I]]=E[T[I]])}return R}(e,["operationalPoints","spaceOrigin","spaceScales","timeOrigin","timeScale","xOffset","yOffset","swapAxis","onHoveredChildUpdate","children","enableSnapping","hideGrid","hidePathsLabels","theme","onPan","onZoom","onClick","onMouseMove"]),[u,n]=r.useState(null),[f,C]=r.useState(null),w=r.useMemo(()=>Object.assign(Object.assign({},Ve),d),[d]),{width:A,height:Z}=Ne(u),J=r.useMemo(()=>JSON.stringify({width:A,height:Z,spaceOrigin:i,spaceScales:l,timeOrigin:x,timeScale:b,xOffset:P,yOffset:v,swapAxis:y,hideGrid:s,hidePathsLabels:m}),[A,Z,i,l,x,b,P,v,y,s,m]),q=r.useMemo(()=>{const E=function($,W){let K=$;if(W.some(z=>z.to<K||(K=z.to,!1)))throw new Error("Invalid scale: 'to' must be greater than previous 'to'.");if(W.some(z=>("size"in z?z.size:z.coefficient)<=0))throw new Error("Invalid scale: 'to' must be greater than 'from'.");const V=[];let ie=0;K=$;for(let z=0;z<W.length;z++){const D=W[z],ae="coefficient"in D?D.coefficient:(D.to-K)/D.size,Se="coefficient"in D?(D.to-K)/D.coefficient:D.size;V.push({from:K,to:D.to,pixelFrom:ie,pixelTo:ie+Se,coefficient:ae}),ie+=Se,K=D.to,z&&(V[z].previous=V[z-1],V[z-1].next=V[z])}return function z(D){if(D.length===0)return{coefficient:1,from:-1/0,to:1/0,pixelFrom:-1/0,pixelTo:1/0};if(D.length===1)return D[0];{const ae=Math.ceil(D.length/2);return{limit:D[ae-1].to,pixelLimit:D[ae-1].pixelTo,from:D[0].from,to:D[D.length-1].to,pixelFrom:D[0].pixelFrom,pixelTo:D[D.length-1].pixelTo,left:z(D.slice(0,ae)),right:z(D.slice(ae))}}}(V)}(i,l),M=y?"y":"x",R=y?"x":"y";let T,I;y?(T=v,I=P):(T=P,I=v);const U=function($,W,K){return V=>W+(V-$)/K}(x,T,b),j=(N=I,F=E,$=>{const{from:W,pixelFrom:K,coefficient:V}=Ie($,F);return N+K+($-W)/V});var N,F;const H=function($,W,K,V){return({time:ie,position:z})=>({[K]:$(ie),[V]:W(z)})}(U,j,M,R),ee=function($,W,K){return V=>(V-W)*K+$}(x,T,b),L=et(i,I,E),Q=function($,W,K,V){return ie=>({time:$(ie[K]),position:W(ie[V])})}(ee,L,M,R),G=[];return{fingerprint:J,width:A,height:Z,getTimePixel:U,getSpacePixel:j,getPoint:H,getTime:ee,getSpace:L,getData:Q,pickingElements:G,resetPickingElements:()=>{G.length=0},registerPickingElement:$=>(G.push($),G.length-1),operationalPoints:o,spaceOrigin:i,spaceScaleTree:E,timeOrigin:x,timeScale:b,timePixelOffset:T,spacePixelOffset:I,timeAxis:M,spaceAxis:R,swapAxis:!!y,enableSnapping:!!p,hideGrid:!!s,hidePathsLabels:!!m,theme:w}},[J]),Y=function(E){const[M,R]=r.useState({isHover:!1,position:{x:NaN,y:NaN}}),T=r.useCallback(j=>{E&&R(N=>Object.assign(Object.assign({},N),{down:{ctrl:j.ctrlKey,shift:j.shiftKey}}))},[E]),I=r.useCallback(()=>{E&&R(j=>Object.assign(Object.assign({},j),{down:void 0}))},[E]),U=r.useCallback(j=>{if(!E)return;const N=Me(j,E),{x:F,y:H}=N,ee=E.offsetWidth,L=E.offsetHeight,Q=F>=0&&F<=ee&&H>=0&&H<=L;R(G=>Object.assign(Object.assign({},G),{position:N,isHover:Q}))},[E]);return r.useEffect(()=>{if(E)return E.addEventListener("mousedown",T),()=>{E.removeEventListener("mousedown",T)}},[E,T]),r.useEffect(()=>(document.addEventListener("mouseup",I),()=>{document.removeEventListener("mouseup",I)}),[I]),r.useEffect(()=>(document.addEventListener("mousemove",U),()=>{document.removeEventListener("mousemove",U)}),[U]),M}(u),{position:B,down:ne,isHover:ue}=Y,{canvasContext:re,hoveredItem:_}=Ke(f,q,B),Pe=r.useMemo(()=>{const E=p?function(M,R){return M&&R?R.element.type==="point"?R.element.point:function(T,I,U){const{x:j,y:N}=T,{x:F,y:H}=I,{x:ee,y:L}=U,Q=ee-F,G=L-H,$=Q*Q+G*G;if($===0)return{x:F,y:H};let W=((j-F)*Q+(N-H)*G)/$;return W<0?W=0:W>1&&(W=1),{x:F+W*Q,y:H+W*G}}(M,R.element.from,R.element.to):M}(Y.position,_):Y.position;return{down:ne,isHover:ue,position:E,hoveredItem:_,data:q.getData(E)}},[p,Y.position,_,ne,ue,q]);return function(E,{position:M,hoveredItem:R,down:T,isHover:I},U,j){const N=r.useRef(j),F=r.useRef(U),[H,ee]=r.useState({type:"idle"});r.useEffect(()=>{N.current=j},[j.fingerprint]),r.useEffect(()=>{F.current=U},[U]);const L=r.useCallback(G=>{if(!E)return;const{onClick:$}=F.current;$&&$({event:G,position:M,data:N.current.getData(M),hoveredItem:R,context:N.current})},[E,R,M]),Q=r.useCallback(G=>{const{onZoom:$}=F.current;$&&E&&$({delta:_e(G),position:Me(G,E),event:G,context:N.current})},[E]);r.useEffect(()=>{if(E)return E.addEventListener("click",L),()=>{E.removeEventListener("click",L)}},[E,L]),r.useEffect(()=>{if(E)return E.addEventListener("wheel",Q),()=>{E.removeEventListener("wheel",Q)}},[E,Q]),r.useEffect(()=>{const{onPan:G}=F.current;T?ee({type:"panning",initialPosition:M,initialData:N.current.getData(M)}):(H.type==="panning"&&G&&G({isPanning:!1,position:M,initialPosition:H.initialPosition,data:N.current.getData(M),initialData:H.initialData,context:N.current}),H.type!=="idle"&&ee({type:"idle"}))},[T]),r.useEffect(()=>{const{onPan:G,onMouseMove:$}=F.current;$&&$({position:M,isHover:I,data:N.current.getData(M),hoveredItem:R,context:N.current}),H.type==="panning"&&G&&G({isPanning:!0,position:M,initialPosition:H.initialPosition,data:N.current.getData(M),initialData:H.initialData,context:N.current})},[M.x,M.y])}(u,Pe,{onPan:g,onZoom:h,onClick:k,onMouseMove:O},q),r.useEffect(()=>{t&&t({item:_,context:q})},[_]),r.useEffect(()=>{(function({breakpoints:E,timeRanges:M,timeCaptionsStyles:R,timeCaptionsPriorities:T,timeGraduationsStyles:I,timeGraduationsPriorities:U}){const j="SpaceTimeChartTheme is invalid:",N=E.length,F=M.length,H=new Set(T.flatMap(L=>L)),ee=new Set(U.flatMap(L=>L));if(T.length!==N)throw new Error(`${j}: timeCaptionsPriorities should have as much elements as breakpoints.`);if(T.some(L=>L.length!==F))throw new Error(`${j}: each array in timeCaptionsPriorities should have as much elements as timeRanges.`);if(Array.from(H).some(L=>L!==0&&!R[L]))throw new Error(`${j}: all values (except 0s) from timeCaptionsPriorities should have a matching style in timeCaptionsStyles.`);if(U.length!==N)throw new Error(`${j}: timeGraduationsPriorities should have as much elements as breakpoints.`);if(U.some(L=>L.length!==F))throw new Error(`${j}: each array in timeGraduationsPriorities should have as much elements as timeRanges.`);if(Array.from(ee).some(L=>L!==0&&!I[L]))throw new Error(`${j}: all values (except 0s) from timeGraduationsPriorities should have a matching style in timeGraduationsStyles.`);if(!I[1])throw new Error(`${j}: there should be a timeGraduationsStyles for value 1.`)})(w)},[w]),S.createElement("div",Object.assign({},c,{ref:n,className:de("relative space-time-chart",c.className),style:{background:w.background}}),S.createElement("div",{ref:C,className:"absolute inset-0"}),S.createElement(qe.Provider,{value:q},S.createElement(Ee.Provider,{value:re},S.createElement(Ye.Provider,{value:Pe},!s&&S.createElement(S.Fragment,null,S.createElement(Ue,null),S.createElement(Qe,null),S.createElement(Xe,null)),a))))};function Ge(e,o,i,[l,x,b],P,v,y=Math.ceil(P/2)){if(o.x>i.x)return Ge(e,i,o,[l,x,b],P);const t=e.width,a=e.height,p=i.x-o.x,s=i.y-o.y,m=Math.sqrt(p*p+s*s),d=-s/m,g=p/m,h=y,k={x:o.x+(+d-p/m)*h,y:o.y+(+g-s/m)*h},O={x:o.x+(-d-p/m)*h,y:o.y+(-g-s/m)*h},c={x:i.x+(p/m-d)*h,y:i.y+(s/m-g)*h},u={x:i.x+(+d+p/m)*h,y:i.y+(+g+s/m)*h},n=o.y<i.y,f=n?u:k,C=n?k:O,w=n?c:u,A=n?O:c,Z=X.clamp(Math.floor(C.x),0,t),J=X.clamp(Math.ceil(w.x),0,t),q=X.clamp(Math.floor(A.y),0,a),Y=X.clamp(Math.ceil(f.y),0,a);for(let B=q;B<=Y;B++){const ne=X.clamp(B<C.y?Math.floor(A.x+(B-A.y)*(C.x-A.x)/(C.y-A.y)):Math.floor(C.x+(B-C.y)*(C.x-f.x)/(C.y-f.y)),Z,J),ue=X.clamp(B<w.y?Math.ceil(A.x+(B-A.y)*(w.x-A.x)/(w.y-A.y)):Math.ceil(w.x+(B-w.y)*(w.x-f.x)/(w.y-f.y)),Z,J);for(let re=ne;re<=ue;re++){const _=4*(B*t+re);e.data[_+3]||(e.data[_]=l,e.data[_+1]=x,e.data[_+2]=b,e.data[_+3]=255)}}}const $e=new Map;function tt(e,{x:o,y:i},l,[x,b,P],v){o=Math.round(o),i=Math.round(i),l=Math.ceil(l);const{width:y,height:t}=e,a=function(s){const m=$e.get(s);if(m)return m;const d=2*s+1,g=new Uint8Array(d*d);for(let h=-s;h<=s;h++)for(let k=-s;k<=s;k++)k*k+h*h<=s*s&&(g[(h+s)*d+(k+s)]=1);return $e.set(s,g),g}(l),p=2*l+1;for(let s=-l;s<=l;s++)for(let m=-l;m<=l;m++)if(a[(s+l)*p+(m+l)]===1){const d=o+m,g=i+s;if(d>=0&&d<y&&g>=0&&g<t){const h=4*(g*y+d);e.data[h]=x,e.data[h+1]=b,e.data[h+2]=P,e.data[h+3]=255}}}const pe=6,we=12;function De(e,o,i,l,x,b,P){P==="out"?function(v,y,t,a,p,s){let m=p==="from"?-1:1,d=(s==="down"?-1:1)*m,g=y+4*m,h=t+(we-2)*d,k=y,O=t;a&&([m,d]=[d,m],[g,h]=[h,g],[k,O]=[O,k]),v.beginPath(),v.moveTo(k,O),v.bezierCurveTo(g,h,g,h,k+we*m,O+we*d),v.stroke()}(e,o,i,l,x,b):function(v,y,t,a){v.beginPath(),a?(v.moveTo(t-pe/2,y),v.lineTo(t+pe/2,y)):(v.moveTo(y,t-pe/2),v.lineTo(y,t+pe/2)),v.stroke()}(e,o,i,l)}const be={1:{width:1.5,endWidth:1.5},2:{width:1,endWidth:1},3:{width:1,endWidth:1,dashArray:[5,5],lineCap:"square"},4:{width:1.5,endWidth:1,dashArray:[0,4],lineCap:"round"}},ut=({path:e,color:o,level:i=2,pickingTolerance:l=5})=>{const x=r.useCallback(({getTimePixel:t,getSpacePixel:a,spaceScaleTree:p,timeAxis:s,spaceAxis:m})=>{const d=[];return e.points.forEach(({position:g,time:h},k,O)=>{if(k){const{position:c,time:u}=O[k-1];je(c,g,p).forEach(n=>{const f=u+(n-c)/(g-c)*(h-u);d.push({[s]:t(f),[m]:a(n)})}),d.push({[s]:t(h),[m]:a(g)})}else d.push({[s]:t(h),[m]:a(g)})}),d},[e]),b=r.useCallback(({getTimePixel:t,getSpacePixel:a,timeAxis:p,spaceAxis:s,operationalPoints:m})=>{const d=[],g=new Set(m.map(h=>h.position));return e.points.forEach(({position:h,time:k})=>{g.has(h)&&d.push({[p]:t(k),[s]:a(h)})}),d},[e]),P=r.useCallback((t,{getTimePixel:a,getSpacePixel:p,operationalPoints:s,swapAxis:m})=>{const d=new Set(s.map(g=>g.position));e.points.forEach(({position:g,time:h},k,O)=>{if(k){const{position:c,time:u}=O[k-1];if(c===g&&d.has(g)){const n=p(g);t.beginPath(),m?(t.moveTo(n,a(u)),t.lineTo(n,a(h))):(t.moveTo(a(u),n),t.lineTo(a(h),n)),t.stroke()}}})},[e]),v=r.useCallback((t,{width:a,height:p,swapAxis:s,theme:{background:m,pathsStyles:{fontSize:d,fontFamily:g}}},h,k,O)=>{if(!h)return;const c=O.findIndex(({x:Y,y:B})=>s?X.inRange(Y,te,a)&&X.inRange(B,0,p):X.inRange(Y,0,a)&&X.inRange(B,0,p-te));if(c<0)return;const u=O[c-1],n=O[c],f=O[c+1];let C=n,w=0;c===0?f&&(w=Math.atan2(f.y-n.y,f.x-n.x)):(C=s?{y:0,x:n.x-n.y*(n.x-u.x)/(n.y-u.y)}:{x:0,y:n.y-n.x*(n.y-u.y)/(n.x-u.x)},w=Math.atan2(n.y-C.y,n.x-C.x)),t.save(),t.translate(C.x,C.y),t.rotate(w),t.font=`${d}px ${g}`,t.textAlign="start";const A=w>=0?-5:15,Z=t.measureText(h),J=Z.width+4,q=Z.actualBoundingBoxAscent+Z.actualBoundingBoxDescent+4;t.globalAlpha=.75,t.fillStyle=m,t.fillRect(3,A-q+2,J,q),t.fillStyle=k,t.globalAlpha=1,t.fillText(h,5,A),t.restore()},[]),y=r.useCallback((t,{getTimePixel:a,getSpacePixel:p,swapAxis:s})=>{if(!e.points.length)return;const m=function({points:O}){if(O.length<2)return"down";for(let c=1,u=Math.min(3,O.length);c<u;c++){const n=O[c].position-O[c-1].position;if(n>0)return"up";if(n<0)return"down"}return"down"}(e),d=e.points[0],g=e.fromEnd||ke,h=X.last(e.points),k=e.toEnd||ke;De(t,a(d.time),p(d.position),s,"from",m,g),De(t,a(h.time),p(h.position),s,"to",m,k)},[e]);return ge("paths",r.useCallback((t,a)=>{t.strokeStyle=o,t.lineWidth=7,t.globalAlpha=.2,t.lineCap="round",P(t,a);const p=be[i];t.strokeStyle=o,t.lineWidth=p.width,t.setLineDash(p.dashArray||[]),t.globalAlpha=p.opacity||1,t.lineCap=p.lineCap||"square",t.beginPath();const s=x(a);s.forEach(({x:m,y:d},g)=>{g?t.lineTo(m,d):t.moveTo(m,d)}),t.stroke(),t.setLineDash([]),t.lineWidth=p.endWidth,y(t,a),a.hidePathsLabels||v(t,a,e.label,o,s)},[o,P,i,x,y,v,e.label])),function(t,a){const{register:p,unregister:s}=r.useContext(Ee);r.useEffect(()=>(p({type:"picking",layer:t,fn:a}),()=>{s({type:"picking",layer:t,fn:a})}),[t,a,p,s])}("paths",r.useCallback((t,a)=>{const{registerPickingElement:p}=a;x(a).forEach((s,m,d)=>{if(m){const g=d[m-1],h=Oe(Ce(p({type:"segment",pathId:e.id,from:g,to:s})));Ge(t,g,s,h,be[i].width+l)}}),b(a).forEach(s=>{const m=Oe(Ce(p({type:"point",pathId:e.id,point:s})));tt(t,s,2*(be[i].width+l),m)})},[x,b,i,e.id,l])),null};export{ct as V,ut as o,lt as s};
