import{r as d,R as N}from"./index-RYns6xqu.js";import{c as Fe}from"./index-Cm1LdsEh.js";import{l as L}from"./lodash-CcdATr5u.js";import{c as Ne}from"./index-CHvE9HB5.js";function Pe(e){const[t,n]=d.useState({width:(e==null?void 0:e.offsetWidth)||1,height:(e==null?void 0:e.offsetHeight)||1});return d.useEffect(()=>{const i=()=>{const r=(e==null?void 0:e.offsetWidth)||1,l=(e==null?void 0:e.offsetHeight)||1;(r!==t.width||l!==t.height)&&n({width:r,height:l})};if(e){const r=new ResizeObserver(i);return r.observe(e),()=>{r.disconnect()}}else{i();return}},[e,t.height,t.width]),t}const _e=d.createContext(void 0),de=d.createContext(void 0),$e=d.createContext(void 0),ye="stop",J=["paths"],Q=["background","graduations","paths","captions","overlay"],Re={},ae={};function we(e){if(ae[e])return ae[e];const t=`#${e.toString(16).padStart(6,"0")}`.toLowerCase();return Re[t]=e,ae[e]=t,t}function He(e){return Re[e.toLowerCase()]}function ce(e){return e.toString(16).padStart(2,"0").toLowerCase()}function Be(e,t,n){return`#${ce(e)}${ce(t)}${ce(n)}`}function ve(e){return Ne(e).rgba()}async function ze(e,t,n="#fff"){if(!t.length)throw Error("There must be at least one layer to capture.");const i=e[t[0]],r=i.width,l=i.height,a=document.createElement("CANVAS");a.setAttribute("width",r+""),a.setAttribute("height",l+"");const s=a.getContext("2d");return s.fillStyle=n,s.fillRect(0,0,r,l),t.forEach(u=>{s.drawImage(e[u],0,0,r,l,0,0,r,l)}),new Promise((u,p)=>{a.toBlob(w=>{w?u(w):p()},"image/png")})}const Se="picking",Te="rendering";function Ge(e,t,n){const i=d.useRef({}),r=d.useRef({}),l=d.useRef(J.reduce((S,g)=>({...S,[g]:new Set}),{})),a=d.useRef(Q.reduce((S,g)=>({...S,[g]:new Set}),{})),s=d.useRef(t),u=d.useRef(null),p=Pe(e),[w,o]=d.useState(null),f=d.useCallback((S,g)=>{S.resetPickingElements(),J.forEach(m=>{if(g&&!g.has(m))return;const c=r.current[`${Se}-${m}`],T=l.current[m];if(c){c.clearRect(0,0,c.canvas.width,c.canvas.height);const C=c.getImageData(0,0,c.canvas.width,c.canvas.height);T.forEach(k=>k(C,S)),c.putImageData(C,0,0)}})},[]),h=d.useCallback((S,g)=>{Q.forEach(m=>{if(g&&!g.has(m))return;const c=r.current[`${Te}-${m}`],T=a.current[m];c&&(c.clearRect(0,0,c.canvas.width,c.canvas.height),T.forEach(C=>C(c,S)))})},[]),E=d.useCallback(()=>{h(s.current),f(s.current),u.current&&(window.cancelAnimationFrame(u.current.frameId),u.current=null)},[]),y=d.useCallback(()=>{u.current||(u.current={frameId:window.requestAnimationFrame(E)})},[]),v=d.useCallback(({type:S,layer:g,fn:m})=>{if(S==="picking"){const c=l.current[g];if(c.has(m))throw new Error("This picking function has already been registered.");c.add(m)}else if(S==="rendering"){const c=a.current[g];if(c.has(m))throw new Error("This drawing function has already been registered.");c.add(m)}y()},[]),b=d.useCallback(({type:S,layer:g,fn:m})=>{if(S==="picking"){const c=l.current[g];if(!c.has(m))throw new Error("This picking function has not been registered.");c.delete(m)}else if(S==="rendering"){const c=a.current[g];if(!c.has(m))throw new Error("This drawing function has not been registered.");c.delete(m)}y()},[]),P=d.useCallback(()=>ze(i.current,Q.map(S=>`${Te}-${S}`),s.current.theme.background),[]);return d.useEffect(()=>{if(!e)return;const S=i.current,g=r.current;[...Q.map(c=>({layer:c,type:"rendering"})),...J.map(c=>({layer:c,type:"picking"}))].forEach(({layer:c,type:T})=>{const C=`${T}-${c}`;if(!S[C]){const k=document.createElement("CANVAS"),A=k.getContext("2d");k.style.position="absolute",k.style.inset="0",e.appendChild(k),S[C]=k,g[C]=A,T==="picking"&&(k.style.display="none")}})},[e]),d.useEffect(()=>{s.current=t,E()},[t.fingerprint]),d.useEffect(()=>{for(const S in i.current){const g=i.current[S];g&&(g.style.width=p.width+"px",g.style.height=p.height+"px",g.setAttribute("width",p.width+"px"),g.setAttribute("height",p.height+"px"))}E()},[p]),d.useEffect(()=>{let S=null;J.some(g=>{const m=r.current[`${Se}-${g}`];if(m&&n){const[c,T,C,k]=m.getImageData(n.x,n.y,1,1).data;if(k===255){const A=Be(c,T,C),O=He(A),x=s.current.pickingElements[O];return S={layer:g,element:x},!0}}return!1}),L.isEqual(S,w)||o(S)},[n,w]),{canvasContext:d.useMemo(()=>({register:v,unregister:b,captureCanvases:P}),[v,b,P]),hoveredItem:w}}function We(e,t){const{register:n,unregister:i}=d.useContext(de);d.useEffect(()=>(n({type:"picking",layer:e,fn:t}),()=>{i({type:"picking",layer:e,fn:t})}),[e,t,n,i])}function ie(e,t){const{register:n,unregister:i}=d.useContext(de);d.useEffect(()=>(n({type:"rendering",layer:e,fn:t}),()=>{i({type:"rendering",layer:e,fn:t})}),[e,t,n,i])}const Ue=()=>{const e=d.useCallback((t,{timePixelOffset:n,getSpacePixel:i,operationalPoints:r,swapAxis:l,width:a,height:s,theme:{spaceGraduationsStyles:u}})=>{const p=l?s:a;r.forEach(w=>{const o=u[w.importanceLevel||0];if(!o)return;t.strokeStyle=o.color,t.lineWidth=o.width,t.globalAlpha=o.opacity||1,o.dashArray&&(t.setLineDash(o.dashArray||[]),t.lineDashOffset=-n);const f=i(w.position);t.beginPath(),l?(t.moveTo(f,0),t.lineTo(f,p)):(t.moveTo(0,f),t.lineTo(p,f)),t.stroke()}),t.setLineDash([]),t.lineDashOffset=0,t.globalAlpha=1},[]);return ie("graduations",e),null},Ye="#000000",H="#2170B9",Ke="#EDEDED",le="#B6B2AF",Ve="#797671",Lt="#FFFFFFC0",It="#EFF3F5",Ot="#FF6868",xt="#D91C1C",Dt="#CAEDDB",Ft="#FFD4D8",Nt="#FFEABF",qe=10,V="IBM Plex Sans",he=1e3,B=60*he,q=60*B,_t=1e3,Ze={background:"white",breakpoints:[.2,.4,.8,2.4,12,32,72,1/0],timeRanges:[10*he,30*he,1*B,5*B,15*B,30*B,1*q,3*q,6*q,12*q,24*q],pathsStyles:{fontSize:qe,fontFamily:V},spaceGraduationsStyles:{1:{width:.5,color:H,opacity:.75},2:{width:.5,color:H,opacity:.25},3:{width:.5,color:Ke}},timeCaptionsPriorities:[[0,0,0,0,0,0,0,0,1,1,1],[0,0,0,0,0,0,0,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1],[0,0,0,0,0,3,1,1,1,1,1],[0,0,0,3,2,1,1,1,1,1,1],[0,0,0,3,2,1,1,1,1,1,1],[0,0,3,2,1,1,1,1,1,1,1],[0,0,3,2,1,1,1,1,1,1,1]],timeCaptionsStyles:{1:{color:Ve,font:`12px ${V}`,topOffset:11},2:{color:le,font:`12px ${V}`,topOffset:9},3:{color:le,font:`10px ${V}`,topOffset:6},4:{color:le,font:`8px ${V}`,topOffset:8}},timeGraduationsPriorities:[[0,0,0,0,0,0,0,4,3,2,1],[0,0,0,0,0,0,4,3,3,2,1],[0,0,0,0,0,6,4,3,3,2,1],[0,0,0,0,6,5,4,3,3,2,1],[0,0,0,6,5,4,3,2,2,2,1],[0,0,6,5,4,4,3,2,2,2,1],[0,6,5,4,4,4,3,2,2,2,1],[6,0,5,4,4,4,3,2,2,2,1]],timeGraduationsStyles:{1:{width:.5,color:Ye},2:{width:.5,color:H,opacity:.77},3:{width:.5,color:H,opacity:.5},4:{width:.5,color:H,opacity:.5,dashArray:[6,6]},5:{width:.5,color:H,opacity:.5,dashArray:[6,18]},6:{width:1,color:H,opacity:.5,dashArray:[1,12]}}},ee=e=>`:${new Date(e).getMinutes().toString().padStart(2,"0")}`,Z=(e,t)=>{const n=new Date(e);if(t>1){const i=n.getHours().toString().padStart(2,"0"),r=n.getMinutes().toString().padStart(2,"0");return`${i}:${r}`}else return n.getHours().toString().padStart(2,"0")},F=33,Xe=[()=>"",()=>"",ee,ee,ee,ee,Z,Z,Z,Z,Z],je=()=>{const e=d.useCallback((t,{timeScale:n,timeOrigin:i,timePixelOffset:r,getTimePixel:l,swapAxis:a,width:s,height:u,theme:{background:p,breakpoints:w,timeRanges:o,timeCaptionsPriorities:f,timeCaptionsStyles:h,timeGraduationsStyles:E}})=>{const y=a?u:s,v=a?s:u,b=i-n*r,P=b+n*s,R=1/n*B;let S=[];w.some((m,c)=>R<m?(S=f[c],!0):!1);const g={};o.map((m,c)=>{const T=S[c];if(!T)return;let C=Math.floor(b/m)*m;for(;C<=P;)T&&(g[C]={level:T,rangeIndex:c}),C+=m}),t.fillStyle=p,a?t.fillRect(0,0,F,y):t.fillRect(0,v-F,y,F),t.strokeStyle=E[1].color,t.lineWidth=E[1].width,t.beginPath(),a?(t.moveTo(F,0),t.lineTo(F,y)):(t.moveTo(0,v-F),t.lineTo(y,v-F)),t.stroke();for(const m in g){const{level:c,rangeIndex:T}=g[m],C=h[c],k=Xe[T],A=k(+m,R);t.textAlign="center",t.textBaseline="top",t.fillStyle=C.color,t.font=`${C.fontWeight||"normal"} ${C.font}`,a?(t.save(),t.translate(F-(C.topOffset||0),l(+m)),t.rotate(Math.PI/2),t.fillText(A,0,0),t.restore()):t.fillText(A,l(+m),v-F+(C.topOffset||0))}},[]);return ie("captions",e),null},Je=()=>{const e=d.useCallback((t,{timeScale:n,timeOrigin:i,timePixelOffset:r,spacePixelOffset:l,getTimePixel:a,swapAxis:s,width:u,height:p,theme:{breakpoints:w,timeRanges:o,timeGraduationsStyles:f,timeGraduationsPriorities:h}})=>{const E=s?p:u,y=s?u:p,v=i-n*r,b=v+n*E,P=1/n*B;let R=[];w.some((g,m)=>P<g?(R=h[m],!0):!1);const S={};o.map((g,m)=>{const c=R[m];if(!c)return;let T=Math.floor(v/g)*g;for(;T<=b;)S[T]=c,T+=g});for(const g in S){const m=S[g],c=f[m];t.strokeStyle=c.color,t.lineWidth=c.width,t.globalAlpha=c.opacity||1,t.setLineDash(c.dashArray||[]),c.dashArray&&(t.lineDashOffset=-l);const T=a(+g);t.beginPath(),s?(t.moveTo(0,T),t.lineTo(y,T)):(t.moveTo(T,0),t.lineTo(T,y)),t.stroke()}t.setLineDash([]),t.lineDashOffset=0,t.globalAlpha=1},[]);return ie("graduations",e),null};function ke(e,t){const n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}function Qe(e){if(typeof e.deltaY<"u")return e.deltaY*-3/360;if(typeof e.detail<"u")return e.detail/-9;throw new Error("Could not extract delta from event.")}function et(e,{position:t,hoveredItem:n,down:i,isHover:r},l,a){const s=d.useRef(a),u=d.useRef(l),[p,w]=d.useState({type:"idle"});d.useEffect(()=>{s.current=a},[a.fingerprint]),d.useEffect(()=>{u.current=l},[l]);const o=d.useCallback(h=>{if(!e)return;const{onClick:E}=u.current;E&&E({event:h,position:t,data:s.current.getData(t),hoveredItem:n,context:s.current})},[e,n,t]),f=d.useCallback(h=>{const{onZoom:E}=u.current;E&&e&&E({delta:Qe(h),position:ke(h,e),event:h,context:s.current})},[e]);d.useEffect(()=>{if(e)return e.addEventListener("click",o),()=>{e.removeEventListener("click",o)}},[e,o]),d.useEffect(()=>{if(e)return e.addEventListener("wheel",f),()=>{e.removeEventListener("wheel",f)}},[e,f]),d.useEffect(()=>{const{onPan:h}=u.current;i?w({type:"panning",initialPosition:t,initialData:s.current.getData(t)}):(p.type==="panning"&&h&&h({isPanning:!1,position:t,initialPosition:p.initialPosition,data:s.current.getData(t),initialData:p.initialData,context:s.current}),p.type!=="idle"&&w({type:"idle"}))},[i]),d.useEffect(()=>{const{onPan:h,onMouseMove:E}=u.current;E&&E({position:t,isHover:r,data:s.current.getData(t),hoveredItem:n,context:s.current}),p.type==="panning"&&h&&h({isPanning:!0,position:t,initialPosition:p.initialPosition,data:s.current.getData(t),initialData:p.initialData,context:s.current})},[t.x,t.y])}function tt(e){const[t,n]=d.useState({isHover:!1,position:{x:NaN,y:NaN}}),i=d.useCallback(a=>{e&&n(s=>({...s,down:{ctrl:a.ctrlKey,shift:a.shiftKey}}))},[e]),r=d.useCallback(()=>{e&&n(a=>({...a,down:void 0}))},[e]),l=d.useCallback(a=>{if(!e)return;const s=ke(a,e),{x:u,y:p}=s,w=e.offsetWidth,o=e.offsetHeight,f=u>=0&&u<=w&&p>=0&&p<=o;n(h=>({...h,position:s,isHover:f}))},[e]);return d.useEffect(()=>{if(e)return e.addEventListener("mousedown",i),()=>{e.removeEventListener("mousedown",i)}},[e,i]),d.useEffect(()=>(document.addEventListener("mouseup",r),()=>{document.removeEventListener("mouseup",r)}),[r]),d.useEffect(()=>(document.addEventListener("mousemove",l),()=>{document.removeEventListener("mousemove",l)}),[l]),t}function nt({breakpoints:e,timeRanges:t,timeCaptionsStyles:n,timeCaptionsPriorities:i,timeGraduationsStyles:r,timeGraduationsPriorities:l}){const a="SpaceTimeChartTheme is invalid:",s=e.length,u=t.length,p=new Set(i.flatMap(o=>o)),w=new Set(l.flatMap(o=>o));if(i.length!==s)throw new Error(`${a}: timeCaptionsPriorities should have as much elements as breakpoints.`);if(i.some(o=>o.length!==u))throw new Error(`${a}: each array in timeCaptionsPriorities should have as much elements as timeRanges.`);if(Array.from(p).some(o=>o!==0&&!n[o]))throw new Error(`${a}: all values (except 0s) from timeCaptionsPriorities should have a matching style in timeCaptionsStyles.`);if(l.length!==s)throw new Error(`${a}: timeGraduationsPriorities should have as much elements as breakpoints.`);if(l.some(o=>o.length!==u))throw new Error(`${a}: each array in timeGraduationsPriorities should have as much elements as timeRanges.`);if(Array.from(w).some(o=>o!==0&&!r[o]))throw new Error(`${a}: all values (except 0s) from timeGraduationsPriorities should have a matching style in timeGraduationsStyles.`);if(!r[1])throw new Error(`${a}: there should be a timeGraduationsStyles for value 1.`)}function ot(e,t,n){let i=e;if(t.some(s=>s.to<i?!0:(i=s.to,!1)))throw new Error("Invalid scale: 'to' must be greater than previous 'to'.");if(t.some(s=>("size"in s?s.size:s.coefficient)<=0))throw new Error("Invalid scale: 'to' must be greater than 'from'.");const r=[];let l=0;i=e;for(let s=0;s<t.length;s++){const u=t[s],p="coefficient"in u?u.coefficient:(u.to-i)/u.size,w="coefficient"in u?(u.to-i)/u.coefficient:u.size;r.push({from:i,to:u.to,pixelFrom:l,pixelTo:l+w,coefficient:p}),l+=w,i=u.to,s&&(r[s].previous=r[s-1],r[s-1].next=r[s])}function a(s){if(s.length===0)return{coefficient:1,from:-1/0,to:1/0,pixelFrom:-1/0,pixelTo:1/0};if(s.length===1)return s[0];{const u=Math.ceil(s.length/2),p=s[u-1].to,w=s[u-1].pixelTo;return{limit:p,pixelLimit:w,from:s[0].from,to:s[s.length-1].to,pixelFrom:s[0].pixelFrom,pixelTo:s[s.length-1].pixelTo,left:a(s.slice(0,u)),right:a(s.slice(u))}}}return a(r)}function Ae(e,t){e=L.clamp(e,t.from,t.to);let n=t;for(;"limit"in n;)e<=n.limit?n=n.left:n=n.right;return n}function it(e,t){e=L.clamp(e,t.pixelFrom,t.pixelTo);let n=t;for(;"pixelLimit"in n;)e<=n.pixelLimit?n=n.left:n=n.right;return n}function st(e,t,n){return i=>t+(i-e)/n}function rt(e,t,n){return i=>(i-t)*n+e}function at(e,t){return n=>{const{from:i,pixelFrom:r,coefficient:l}=Ae(n,t);return e+r+(n-i)/l}}function ct(e,t,n){return i=>{const{from:r,pixelFrom:l,coefficient:a}=it(i-t,n);return e+r+(i-t-l)*a}}function lt(e,t,n,i){return r=>({time:e(r[n]),position:t(r[i])})}function ut(e,t,n,i){return({time:r,position:l})=>({[n]:e(r),[i]:t(l)})}function $t(e,t){const i=e.points.slice(0,-1).map((a,s)=>[a,e.points[s+1]]).find(([a,s])=>L.inRange(t,a.time,s.time));if(i){const[a,s]=i;return a.position+(t-a.time)/(s.time-a.time)*(s.position-a.position)}let r=e.points[0],l=e.points[0];return e.points.slice(1).forEach(a=>{a.time<r.time&&(r=a),a.time>l.time&&(l=a)}),r.time>t?r.position:l.position}function Me(e,t,n){if(t<e)return Me(t,e,n).reverse();e=Math.max(e,n.from),t=Math.min(t,n.to);let i=Ae(e,n),r=e;const l=[];for(;i.to<t;)i.to!==r&&l.push(i.to),r=i.to,i=i.next;return l}function ft(e,t,n){const{x:i,y:r}=e,{x:l,y:a}=t,{x:s,y:u}=n,p=s-l,w=u-a,o=i-l,f=r-a,h=o*p+f*w,E=p*p+w*w;if(E===0)return{x:l,y:a};let y=h/E;return y<0?y=0:y>1&&(y=1),{x:l+y*p,y:a+y*w}}function ht(e,t){return!e||!t?e:t.element.type==="point"?t.element.point:ft(e,t.element.from,t.element.to)}const Ht=e=>{const{operationalPoints:t,spaceOrigin:n,spaceScales:i,timeOrigin:r,timeScale:l,xOffset:a=0,yOffset:s=0,swapAxis:u,onHoveredChildUpdate:p,children:w,enableSnapping:o,hideGrid:f,hidePathsLabels:h,theme:E,onPan:y,onZoom:v,onClick:b,onMouseMove:P,...R}=e,[S,g]=d.useState(null),[m,c]=d.useState(null),T=d.useMemo(()=>({...Ze,...E}),[E]),{width:C,height:k}=Pe(S),A=d.useMemo(()=>JSON.stringify({width:C,height:k,spaceOrigin:n,spaceScales:i,timeOrigin:r,timeScale:l,xOffset:a,yOffset:s,swapAxis:u,hideGrid:f,hidePathsLabels:h}),[C,k,n,i,r,l,a,s,u,f,h]),O=d.useMemo(()=>{const G=ot(n,i),se=u?"y":"x",re=u?"x":"y";let Y,K;u?(Y=s,K=a):(Y=a,K=s);const pe=st(r,Y,l),ge=at(K,G),Oe=ut(pe,ge,se,re),me=rt(r,Y,l),Ee=ct(n,K,G),xe=lt(me,Ee,se,re),j=[];return{fingerprint:A,width:C,height:k,getTimePixel:pe,getSpacePixel:ge,getPoint:Oe,getTime:me,getSpace:Ee,getData:xe,pickingElements:j,resetPickingElements:()=>{j.length=0},registerPickingElement:De=>(j.push(De),j.length-1),operationalPoints:t,spaceOrigin:n,spaceScaleTree:G,timeOrigin:r,timeScale:l,timePixelOffset:Y,spacePixelOffset:K,timeAxis:se,spaceAxis:re,swapAxis:!!u,enableSnapping:!!o,hideGrid:!!f,hidePathsLabels:!!h,theme:T}},[A]),x=tt(S),{position:M,down:z,isHover:W}=x,{canvasContext:$,hoveredItem:I}=Ge(m,O,M),U=d.useMemo(()=>{const G=o?ht(x.position,I):x.position;return{down:z,isHover:W,position:G,hoveredItem:I,data:O.getData(G)}},[o,x.position,I,z,W,O]);return et(S,U,{onPan:y,onZoom:v,onClick:b,onMouseMove:P},O),d.useEffect(()=>{p&&p({item:I,context:O})},[I]),d.useEffect(()=>{nt(T)},[T]),N.createElement("div",{...R,ref:g,className:Fe("relative space-time-chart",R.className),style:{background:T.background}},N.createElement("div",{ref:c,className:"absolute inset-0"}),N.createElement(_e.Provider,{value:O},N.createElement(de.Provider,{value:$},N.createElement($e.Provider,{value:U},!f&&N.createElement(N.Fragment,null,N.createElement(Ue,null),N.createElement(Je,null),N.createElement(je,null)),w))))};function Le(e,t,n,[i,r,l],a,s,u=Math.ceil(a/2)){if(t.x>n.x)return Le(e,n,t,[i,r,l],a);const p=e.width,w=e.height,o=n.x-t.x,f=n.y-t.y,h=Math.sqrt(o*o+f*f),E=-f/h,y=o/h,v=u,b={x:t.x+(+E-o/h)*v,y:t.y+(+y-f/h)*v},P={x:t.x+(-E-o/h)*v,y:t.y+(-y-f/h)*v},R={x:n.x+(-E+o/h)*v,y:n.y+(-y+f/h)*v},S={x:n.x+(+E+o/h)*v,y:n.y+(+y+f/h)*v},g=t.y<n.y,m=g?S:b,c=g?b:P,T=g?R:S,C=g?P:R,k=L.clamp(Math.floor(c.x),0,p),A=L.clamp(Math.ceil(T.x),0,p),O=L.clamp(Math.floor(C.y),0,w),x=L.clamp(Math.ceil(m.y),0,w);for(let M=O;M<=x;M++){const z=L.clamp(M<c.y?Math.floor(C.x+(M-C.y)*(c.x-C.x)/(c.y-C.y)):Math.floor(c.x+(M-c.y)*(c.x-m.x)/(c.y-m.y)),k,A),W=L.clamp(M<T.y?Math.ceil(C.x+(M-C.y)*(T.x-C.x)/(T.y-C.y)):Math.ceil(T.x+(M-T.y)*(T.x-m.x)/(T.y-m.y)),k,A);for(let $=z;$<=W;$++){const I=(M*p+$)*4;e.data[I+3]||(e.data[I]=i,e.data[I+1]=r,e.data[I+2]=l,e.data[I+3]=255)}}}const Ce=new Map;function dt(e){const t=Ce.get(e);if(t)return t;const n=e*2+1,i=new Uint8Array(n*n);for(let r=-e;r<=e;r++)for(let l=-e;l<=e;l++)if(l*l+r*r<=e*e){const s=l+e,u=r+e;i[u*n+s]=1}return Ce.set(e,i),i}function pt(e,{x:t,y:n},i,[r,l,a],s){t=Math.round(t),n=Math.round(n),i=Math.ceil(i);const{width:u,height:p}=e,w=dt(i),o=i*2+1;for(let f=-i;f<=i;f++)for(let h=-i;h<=i;h++){const E=(f+i)*o+(h+i);if(w[E]===1){const y=t+h,v=n+f;if(y>=0&&y<u&&v>=0&&v<p){const b=(v*u+y)*4;e.data[b]=r,e.data[b+1]=l,e.data[b+2]=a,e.data[b+3]=255}}}}const te=6;function gt(e,t,n,i){e.beginPath(),i?(e.moveTo(n-te/2,t),e.lineTo(n+te/2,t)):(e.moveTo(t,n-te/2),e.lineTo(t,n+te/2)),e.stroke()}const ue=12;function mt(e,t,n,i,r,l){let a=r==="from"?-1:1,s=(l==="down"?-1:1)*a,u=t+4*a,p=n+(ue-2)*s,w=t,o=n;i&&([a,s]=[s,a],[u,p]=[p,u],[w,o]=[o,w]),e.beginPath(),e.moveTo(w,o),e.bezierCurveTo(u,p,u,p,w+ue*a,o+ue*s),e.stroke()}function be(e,t,n,i,r,l,a){a==="out"?mt(e,t,n,i,r,l):gt(e,t,n,i)}function Et({points:e},t){if(e.length<2)return"down";for(let n=1,i=Math.min(3,e.length);n<i;n++){const r=e[n].position-e[n-1].position;if(r>0)return"up";if(r<0)return"down"}return"down"}const yt=5,wt=7,vt=.2,fe={1:{width:1.5,endWidth:1.5},2:{width:1,endWidth:1},3:{width:1,endWidth:1,dashArray:[5,5],lineCap:"square"},4:{width:1.5,endWidth:1,dashArray:[0,4],lineCap:"round"}},St=2,Bt=({path:e,color:t,level:n=St,pickingTolerance:i=yt})=>{const r=d.useCallback(({getTimePixel:o,getSpacePixel:f,spaceScaleTree:h,timeAxis:E,spaceAxis:y})=>{const v=[];return e.points.forEach(({position:b,time:P},R,S)=>{if(!R)v.push({[E]:o(P),[y]:f(b)});else{const{position:g,time:m}=S[R-1];Me(g,b,h).forEach(T=>{const C=m+(T-g)/(b-g)*(P-m);v.push({[E]:o(C),[y]:f(T)})}),v.push({[E]:o(P),[y]:f(b)})}}),v},[e]),l=d.useCallback(({getTimePixel:o,getSpacePixel:f,timeAxis:h,spaceAxis:E,operationalPoints:y})=>{const v=[],b=new Set(y.map(P=>P.position));return e.points.forEach(({position:P,time:R})=>{b.has(P)&&v.push({[h]:o(R),[E]:f(P)})}),v},[e]),a=d.useCallback((o,{getTimePixel:f,getSpacePixel:h,operationalPoints:E,swapAxis:y})=>{const v=new Set(E.map(b=>b.position));e.points.forEach(({position:b,time:P},R,S)=>{if(R){const{position:g,time:m}=S[R-1];if(g===b&&v.has(b)){const c=h(b);o.beginPath(),y?(o.moveTo(c,f(m)),o.lineTo(c,f(P))):(o.moveTo(f(m),c),o.lineTo(f(P),c)),o.stroke()}}})},[e]),s=d.useCallback((o,{width:f,height:h,swapAxis:E,theme:{background:y,pathsStyles:{fontSize:v,fontFamily:b}}},P,R,S)=>{if(!P)return;const g=S.findIndex(({x:I,y:U})=>E?L.inRange(I,F,f)&&L.inRange(U,0,h):L.inRange(I,0,f)&&L.inRange(U,0,h-F));if(g<0)return;const m=S[g-1],c=S[g],T=S[g+1];let C=c,k=0;g===0?T&&(k=Math.atan2(T.y-c.y,T.x-c.x)):(E?C={y:0,x:c.x-c.y*(c.x-m.x)/(c.y-m.y)}:C={x:0,y:c.y-c.x*(c.y-m.y)/(c.x-m.x)},k=Math.atan2(c.y-C.y,c.x-C.x)),o.save(),o.translate(C.x,C.y),o.rotate(k),o.font=`${v}px ${b}`,o.textAlign="start";const A=5,O=k>=0?-5:15,x=2,M=o.measureText(P),z=M.width+2*x,$=M.actualBoundingBoxAscent+M.actualBoundingBoxDescent+2*x;o.globalAlpha=.75,o.fillStyle=y,o.fillRect(A-x,O-$+x,z,$),o.fillStyle=R,o.globalAlpha=1,o.fillText(P,A,O),o.restore()},[]),u=d.useCallback((o,{getTimePixel:f,getSpacePixel:h,swapAxis:E})=>{if(!e.points.length)return;const y=Et(e),v=e.points[0],b=e.fromEnd||ye,P=L.last(e.points),R=e.toEnd||ye;be(o,f(v.time),h(v.position),E,"from",y,b),be(o,f(P.time),h(P.position),E,"to",y,R)},[e]),p=d.useCallback((o,f)=>{o.strokeStyle=t,o.lineWidth=wt,o.globalAlpha=vt,o.lineCap="round",a(o,f);const h=fe[n];o.strokeStyle=t,o.lineWidth=h.width,o.setLineDash(h.dashArray||[]),o.globalAlpha=h.opacity||1,o.lineCap=h.lineCap||"square",o.beginPath();const E=r(f);E.forEach(({x:y,y:v},b)=>{b?o.lineTo(y,v):o.moveTo(y,v)}),o.stroke(),o.setLineDash([]),o.lineWidth=h.endWidth,u(o,f),f.hidePathsLabels||s(o,f,e.label,t,E)},[t,a,n,r,u,s,e.label]);ie("paths",p);const w=d.useCallback((o,f)=>{const{registerPickingElement:h}=f;r(f).forEach((E,y,v)=>{if(y){const b=v[y-1],P=h({type:"segment",pathId:e.id,from:b,to:E}),R=ve(we(P));Le(o,b,E,R,fe[n].width+i)}}),l(f).forEach(E=>{const y=h({type:"point",pathId:e.id,point:E}),v=ve(we(y));pt(o,E,(fe[n].width+i)*2,v)})},[r,l,n,e.id,i]);return We("paths",w),null},_=1e3,D=60*1e3;function ne(e,t,n,i,r,l,a,s){const u=[];for(let p=0;p<l;p++){let w=a+p*i,o=t[0].position;const f={id:`${e}-${p+1}`,label:`Train ${e} ${p+1}`,points:[{position:o,time:w}],...s};t.forEach((h,E)=>{if(E){const y=t[E-1],v=h.position-y.position,b=v/r;o+=v,w+=b,f.points.push({position:o,time:w})}w+=n,f.points.push({position:o,time:w})}),u.push(f)}return u}const X=[{id:"city-a",label:"Point A",position:0*_,importanceLevel:1},{id:"city-b",label:"Point B",position:10*_,importanceLevel:2},{id:"city-c",label:"Point C",position:60*_,importanceLevel:1},{id:"city-d",label:"Point D",position:70*_,importanceLevel:2},{id:"city-e",label:"Point E",position:90*_,importanceLevel:2},{id:"city-f",label:"Point F",position:140*_,importanceLevel:1}],Tt=X.slice(0).reverse(),Ie=[X[0],X[2],X[5]],Ct=Ie.slice(0).reverse(),oe=new Date("2024/04/02"),zt=[...ne("omnibus",X,3*D,30*D,80*_/(60*D),5,+oe,{color:"#FF362E"}),...ne("omnibus-reversed",Tt,3*D,35*D,-(80*_)/(60*D),4,+oe,{color:"#FF8E3D"}),...ne("fast",Ie,5*D,50*D,140*_/(60*D),3,+oe,{color:"#526CE8",fromEnd:"out",toEnd:"out"}),...ne("fast-reversed",Ct,5*D,45*D,-(140*_)/(60*D),3,+oe,{color:"#66C0F1",fromEnd:"out",toEnd:"out"})];export{It as A,de as C,Ot as E,q as H,_t as K,B as M,X as O,zt as P,Ht as S,Lt as W,Bt as a,oe as b,xt as c,_e as d,$e as e,$t as f,ne as g,Dt as h,Ft as i,Nt as j,ie as u};
