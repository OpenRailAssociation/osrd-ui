import{r as a,R as d}from"./index-RYns6xqu.js";import{s as q,V as J,o as Q}from"./index.esm-BVcIDkGw.js";/* empty css              *//* empty css              */import"./index-Cm1LdsEh.js";import"./index.esm-CkK1enDk.js";import"./lodash-CcdATr5u.js";import"./index-CHvE9HB5.js";const j={operational_points:[{id:"South_West_station",part:{track:"TB0",position:500,extensions:{sncf:null}},extensions:{sncf:{ci:0,ch:"BV",ch_short_label:"BV",ch_long_label:"0",trigram:"SWS"},identifier:{name:"South_West_station",uic:1}},position:0},{id:"Mid_West_station",part:{track:"TC2",position:450,extensions:{sncf:null}},extensions:{sncf:{ci:0,ch:"BV",ch_short_label:"BV",ch_long_label:"0",trigram:"MWS"},identifier:{name:"Mid_West_station",uic:3}},position:13e6},{id:"Mid_East_station",part:{track:"TD1",position:14e3,extensions:{sncf:null}},extensions:{sncf:{ci:0,ch:"BV",ch_short_label:"BV",ch_long_label:"0",trigram:"MES"},identifier:{name:"Mid_East_station",uic:4}},position:2755e4},{id:"North_East_station",part:{track:"TG5",position:1500,extensions:{sncf:null}},extensions:{sncf:{ci:0,ch:"BV",ch_short_label:"BV",ch_long_label:"0",trigram:"NES"},identifier:{name:"North_East_station",uic:7}},position:4705e4}]},ee=[{id:1,name:"Train 1",departure_time:"2024-06-26T13:57:56Z",rolling_stock_length:26070,space_time_curves:[{positions:[0,2387,8642,17449,28163,68719,118795,196855,406366,706610,1102281,1593458,2283409,3769056,6017136,6717050,7000182,9027079,9707244,9996142,12098691,12253708,12305708,12368708,12400708,12424708,12440708,12445708,12448708,12449708,12449708,12452095,12458350,12467157,12490130,12534192,12586918,12734703,12960612,13274175,13680049,14178452,14981343,15960690,18996492,19991990,20987213,22014758,22841279,23850682,26994761,28007168,29005477,30000065,32001426,34522793,44638554,44776040,44832040,44901040,44937040,44976040,44992040,44997040,45000040,45001040],times:[0,42e3,44e3,46e3,48e3,54e3,6e4,68e3,86e3,108e3,134e3,164e3,204e3,286e3,406e3,442e3,456e3,558e3,594e3,61e4,724159,733630,737630,743630,747630,751630,755630,757630,759630,761630,821630,823630,825630,827630,831630,837630,843630,857630,875630,897630,923630,953630,999630,1053630,1215630,1269630,1327630,1389630,1437630,1493630,1661630,1713630,1761630,1807630,1903630,2031630,2561539,2569617,2573617,2579617,2583617,2589617,2593617,2595617,2597617,2599617]}]},{id:2,name:"Train 2",departure_time:"2024-06-26T13:42:56Z",rolling_stock_length:26070,space_time_curves:[{positions:[0,2387,8642,17449,28163,68719,118795,196855,406366,706610,1102281,1593458,2283409,3769056,6017136,6717050,7000182,9027079,9707244,9996142,12098691,12253708,12305708,12368708,12400708,12424708,12440708,12445708,12448708,12449708,12449708,12452095,12458350,12467157,12490130,12534192,12586918,12734703,12960612,13274175,13680049,14178452,14981343,15960690,18996492,19991990,20987213,22014758,22841279,23850682,26994761,28007168,29005477,30000065,32001426,34522793,44638554,44776040,44832040,44901040,44937040,44976040,44992040,44997040,45000040,45001040],times:[0,42e3,44e3,46e3,48e3,54e3,6e4,68e3,86e3,108e3,134e3,164e3,204e3,286e3,406e3,442e3,456e3,558e3,594e3,61e4,724159,733630,737630,743630,747630,751630,755630,757630,759630,761630,821630,823630,825630,827630,831630,837630,843630,857630,875630,897630,923630,953630,999630,1053630,1215630,1269630,1327630,1389630,1437630,1493630,1661630,1713630,1761630,1807630,1903630,2031630,2561539,2569617,2573617,2579617,2583617,2589617,2593617,2595617,2597617,2599617]}]},{id:3,name:"Train 3",departure_time:"2024-06-26T14:12:56Z",rolling_stock_length:26070,space_time_curves:[{positions:[0,2387,8642,17449,28163,68719,118795,196855,406366,706610,1102281,1593458,2283409,3769056,6017136,6717050,7000182,9027079,9707244,9996142,12098691,12253708,12305708,12368708,12400708,12424708,12440708,12445708,12448708,12449708,12449708,12452095,12458350,12467157,12490130,12534192,12586918,12734703,12960612,13274175,13680049,14178452,14981343,15960690,18996492,19991990,20987213,22014758,22841279,23850682,26994761,28007168,29005477,30000065,32001426,34522793,44638554,44776040,44832040,44901040,44937040,44976040,44992040,44997040,45000040,45001040],times:[0,42e3,44e3,46e3,48e3,54e3,6e4,68e3,86e3,108e3,134e3,164e3,204e3,286e3,406e3,442e3,456e3,558e3,594e3,61e4,724159,733630,737630,743630,747630,751630,755630,757630,759630,761630,821630,823630,825630,827630,831630,837630,843630,857630,875630,897630,923630,953630,999630,1053630,1215630,1269630,1327630,1389630,1437630,1493630,1661630,1713630,1761630,1807630,1903630,2031630,2561539,2569617,2573617,2579617,2583617,2589617,2593617,2595617,2597617,2599617]}]}],te=(e,s)=>{const[o,n]=a.useState(!1);return a.useLayoutEffect(()=>{const{current:t}=e,c=()=>{if(t){const l=t.scrollHeight>t.clientHeight;n(l),s&&s(l)}};t&&("ResizeObserver"in window&&new ResizeObserver(c).observe(t),c())},[s,e]),o},se=(e,s)=>e.positions.map((o,n)=>({time:e.times[n]+new Date(s).getTime(),position:o})),oe=(e,s)=>a.useMemo(()=>e.flatMap(o=>o.space_time_curves.map((n,t)=>({id:`${o.id}-${t}`,label:o.name,color:s&&s===o.id?"#201EDE":"#000000",points:se(n,o.departure_time)}))),[e,s]),T=32,ne=521,ie=ne+40,ae=1,re=10,ce=1,le=10.5,$=.5,me=40,C=60*60*12,b=e=>e-me-T,fe=e=>e/1e3,A=e=>e.at(-1).position-e.at(0).position,ue=(e,{height:s,isProportional:o,yZoom:n})=>{if(!o||e.length===0)return e.map(u=>({...u,display:!0}));const t=[{...e[0],display:!0}],c=A(e),l=b(s);let m=t[0];for(let u=1;u<e.length;u++){const r=e[u],O=(r.position-m.position)/c*l*n>=T;O&&(t.push({...r,display:O}),m=r)}const f=t[t.length-1];if(!f.display){const u=t.findLast(r=>r.display);u&&(u.display=!1,f.display=!0)}return t},pe=(e,{height:s,isProportional:o,yZoom:n})=>{if(e.length<2)return[];const t=A(e),c=b(s);return e.map((l,m)=>{const f=e.at(m+1);return f?o?{...l,styles:{height:`${(f.position-l.position)/t*c*n}px`}}:{...l,styles:{height:`${T*n}px`}}:{...l,styles:{height:`${T}px`}}})},_e=e=>{const{minTime:s,maxTime:o}=e.reduce((t,c)=>{if(c.space_time_curves.length===0)return t;const l=c.space_time_curves.at(-1);if(!l||l.times.length<2)return t;const m=Number(new Date(c.departure_time)),f=Number(new Date(c.departure_time))+l.times.at(-1);return{minTime:t.minTime===-1||t.minTime>m?m:t.minTime,maxTime:t.maxTime===-1||t.maxTime<f?f:t.maxTime}},{minTime:-1,maxTime:-1}),n=fe(o-s);return n>C?C:n},de=e=>e.map(s=>({id:s.id,label:s.id,position:s.position,importanceLevel:1})),he=(e,{height:s,isProportional:o,yZoom:n})=>{if(e.length<2)return[];if(!o)return e.slice(0,-1).map((u,r)=>{const h=e[r+1];return{from:u.position,to:h.position,size:T*n}});const t=e.at(0).position,c=e.at(-1).position,l=A(e),m=b(s),f=o?{coefficient:l/m/n}:{size:T*(e.length-1)*n};return[{from:t,to:c,...f}]},ge=(e,s,{delta:o,position:{x:n}})=>{const t=Math.min(Math.max(e*(1+o/10),ae),re);return{xZoom:t,xOffset:n-(n-s)/e*t}};function Te(e,s){return{x:s.x-e.x,y:s.y-e.y}}const Oe=(e,s,o,n,t=561)=>{const[c,l]=a.useState(!1),[m,f]=a.useState({xZoom:1,yZoom:1,xOffset:0,yOffset:0,panning:null,scrollPosition:0,isProportional:!0,operationalPointsChart:[],panY:!1,scales:[]}),{xZoom:u,yZoom:r,xOffset:h,yOffset:O,panY:I,panning:P,scrollPosition:D,isProportional:_}=m,v=oe(s,n),U=a.useCallback(i=>{f(p=>({...p,panY:i}))},[]);te(o,U);const k=a.useMemo(()=>_e(s),[s]),x=a.useMemo(()=>ue(e,{height:t,isProportional:_,yZoom:r}),[e,t,_,r]),H=a.useMemo(()=>pe(x,{height:t,isProportional:_,yZoom:r}),[x,t,r,_]),y=a.useMemo(()=>de(x),[x]),L=a.useCallback(()=>{r<le&&f(i=>({...i,yZoom:r+$}))},[r]),W=a.useCallback(()=>{r>ce&&f(i=>({...i,yZoom:r-$}))},[r]),N=a.useCallback(()=>{f(i=>({...i,yZoom:1}))},[]),Z=a.useCallback(()=>{if(!c&&o.current){const{scrollTop:i}=o.current;(i||i===0)&&f(p=>({...p,scrollPosition:i,yOffset:i}))}},[c,o]),S=a.useCallback(i=>{i.key==="Shift"&&l(!0)},[]),w=a.useCallback(i=>{i.key==="Shift"&&l(!1)},[]);a.useEffect(()=>(window.addEventListener("keydown",S),window.addEventListener("keyup",w),()=>{window.removeEventListener("keydown",S),window.removeEventListener("keyup",w)}),[S,w]);const B=a.useCallback(()=>{f(i=>({...i,isProportional:!i.isProportional}))},[]),R=a.useMemo(()=>he(y,{height:t,isProportional:_,yZoom:r}),[y,t,_,r]),V=a.useMemo(()=>({operationalPoints:H,zoomYIn:L,zoomYOut:W,resetZoom:N,toggleMode:B,yZoom:r,isProportional:_}),[H,L,W,N,B,r,_]),Y=a.useMemo(()=>({operationalPoints:y,spaceScales:R,timeScale:k/u,paths:v,xOffset:h,yOffset:-D+14,onZoom:i=>{c&&f(p=>({...p,...ge(p.xZoom,p.xOffset,i)}))},onPan:i=>{const p=Te(i.initialPosition,i.position),g={...m};if(!i.isPanning)g.panning=null;else if(!P)g.panning={initialOffset:{x:h,y:O}};else{const{initialOffset:z}=P;if(g.xOffset=z.x+p.x,I){const E=z.y-p.y;o.current&&E>=0&&E+ie<=o.current.scrollHeight&&(g.yOffset=E,g.scrollPosition=E,o.current.scrollTop=E)}}f(g)}}),[y,R,k,u,v,h,I,D,c,m,P,O,o]);return a.useMemo(()=>({manchetteProps:V,spaceTimeChartProps:Y,handleScroll:Z}),[V,Y,Z])},G=561,Ee=({operationalPoints:e,projectPathTrainResult:s,selectedTrain:o})=>{const n=a.useRef(null),{manchetteProps:t,spaceTimeChartProps:c,handleScroll:l}=Oe(e,s,n,o);return d.createElement("div",{className:"manchette-space-time-chart-wrapper"},d.createElement("div",{className:"header bg-ambientB-5 w-full border-b border-grey-30",style:{height:"40px"}}),d.createElement("div",{ref:n,className:"manchette flex",style:{height:`${G}px`},onScroll:l},d.createElement(q,{...t}),d.createElement("div",{className:"space-time-chart-container w-full sticky",style:{bottom:0,left:0,top:2,height:`${G-6}px`}},d.createElement(J,{className:"inset-0 absolute h-full",spaceOrigin:0,timeOrigin:Math.min(...s.map(m=>+new Date(m.departure_time))),...c},c.paths.map(m=>d.createElement(Q,{key:m.id,path:m,color:m.color}))))))},Ie={title:"Manchette with SpaceTimeChart/rendering",component:Ee},M={args:{operationalPoints:j.operational_points,projectPathTrainResult:ee,selectedTrain:1}};var F,X,K;M.parameters={...M.parameters,docs:{...(F=M.parameters)==null?void 0:F.docs,source:{originalSource:`{
  args: {
    operationalPoints: SAMPLE_PATH_PROPERTIES_DATA.operational_points,
    projectPathTrainResult: SAMPLE_PATHS_DATA,
    selectedTrain: 1
  }
}`,...(K=(X=M.parameters)==null?void 0:X.docs)==null?void 0:K.source}}};const De=["Default"];export{M as Default,De as __namedExportsOrder,Ie as default};
